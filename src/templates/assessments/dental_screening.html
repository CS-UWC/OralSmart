{% load static %}

        {% if form.errors %}
        <div class="alert alert-danger">
            <ul>
            {% for field, errors in form.errors.items %}
                <li>{{ field }}: {{ errors|striptags }}</li>
            {% endfor %}
            </ul>
        </div>
        {% endif %}

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-warning alert-dismissible fade show auto-dismiss-alert" role="alert">
                <strong>{{ message }}</strong>
                <button type="button" class="btn btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
    {% endif %}
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(function() {
            document.querySelectorAll('.auto-dismiss-alert').forEach(function(alert) {
                var bsAlert = bootstrap.Alert.getOrCreateInstance(alert);
                bsAlert.close();
            });
        }, 5000); //3 seconds
    });
    </script>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dental Assessment - Accordion Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .risk-question {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        .high-risk {
            border-left: 4px solid #dc3545;
            background-color: #fdf2f2;
        }
        .moderate-risk {
            border-left: 4px solid #ffc107;
            background-color: #fffbf0;
        }
        .low-risk {
            border-left: 4px solid #28a745;
            background-color: #f0f8f0;
        }
        .question-text {
            font-weight: 500;
            margin-bottom: 10px;
        }
        .checkbox-item {
            margin-right: 15px;
        }
        .checkbox-item input {
            margin-right: 5px;
        }
        .income-grid .d-flex {
            margin-bottom: 8px;
        }
        .dmft-table {
            width: 100%;
            margin: 20px 0;
        }
        .dmft-table td {
            text-align: center;
            padding: 10px;
            border: 1px solid #ddd;
        }
        .dmft-table label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .tooth-select {
            width: 100%;
            padding: 5px;
        }
        .instructions-table th {
            background-color: #f8f9fa;
        }
        .section-title {
            color: #2c3e50;
            margin: 30px 0 20px 0;
        }
        .accordion-button:disabled {
            opacity: 0.6;
            pointer-events: none;
        }
        .required-asterisk {
            color: #dc3545;
            font-weight: bold;
            margin-left: 4px;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">Dental Assessment Form</h1>
        
        <form method="post" action="#">
            
            {% csrf_token %}

            <div class="accordion" id="questionnaireAccordion">
                
                <!-- Section 1: Social / Behavioural / Medical Risk Factors -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingOne">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#sectionOne" aria-expanded="true" aria-controls="sectionOne">
                            Section 1: Social / Behavioural / Medical Risk Factors
                        </button>
                    </h2>
                    <div id="sectionOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#questionnaireAccordion">
                        <div class="accordion-body">
                            
                            <div class="risk-question moderate-risk">
                                <div class="question-text">1.1) Is the child a South African citizen?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="d-flex align-items-center gap-3">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="sa_citizen_yes" name="sa_citizen" value="yes">
                                        <label for="sa_citizen_yes">Yes</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="sa_citizen_no" name="sa_citizen" value="no">
                                        <label for="sa_citizen_no">No</label>
                                    </div>
                                </div>
                            </div>

                            <div class="risk-question moderate-risk">
                                <div class="question-text">1.2) Does the child have special health care needs?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="d-flex align-items-center gap-3">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="special_needs_yes" name="special_needs" value="yes">
                                        <label for="special_needs_yes">Yes</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="special_needs_no" name="special_needs" value="no">
                                        <label for="special_needs_no">No</label>
                                    </div>
                                </div>
                            </div>

                            <div class="risk-question high-risk">
                                <div class="question-text">
                                    1.3) Has the primary caregiver undergone any dental decay treatment such as fillings, extractions, etc?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="d-flex align-items-center gap-3">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="caregiver_treatment_yes" name="caregiver_treatment" value="yes">
                                        <label for="caregiver_treatment_yes">Yes</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="caregiver_treatment_no" name="caregiver_treatment" value="no">
                                        <label for="caregiver_treatment_no">No</label>
                                    </div>
                                </div>
                            </div>

                            <div class="risk-question">
                                <div class="question-text">1.4) Monthly household income?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="income-grid">
                                    <div class="d-flex flex-wrap gap-3">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="income_0" name="income" value="0">
                                            <label for="income_0">R0</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="income_1_2500" name="income" value="1-2500">
                                            <label for="income_1_2500">R1-R2500</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="income_2501_5000" name="income" value="2501-5000">
                                            <label for="income_2501_5000">R2501-R5000</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="income_5000_10000" name="income" value="5000-10000">
                                            <label for="income_5000_10000">R5000-R10000</label>
                                        </div>
                                    </div>
                                    <div class="d-flex flex-wrap gap-3 mt-2">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="income_10001_20000" name="income" value="10001-20000">
                                            <label for="income_10001_20000">R10001-R20000</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="income_20001_40000" name="income" value="20001-40000">
                                            <label for="income_20001_40000">R20001-R40000</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="income_40001_70000" name="income" value="40001-70000">
                                            <label for="income_40001_70000">R40001-R70000</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="income_70001_plus" name="income" value="70001+">
                                            <label for="income_70001_plus">R70001+</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="risk-question high-risk">
                                <div class="question-text">1.5) Does the child usually eat (> 3x/day) meals that are sugar-containing?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="d-flex align-items-center gap-3">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="sugar_meals_yes" name="sugar_meals" value="yes">
                                        <label for="sugar_meals_yes">Yes</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="sugar_meals_no" name="sugar_meals" value="no">
                                        <label for="sugar_meals_no">No</label>
                                    </div>
                                </div>
                            </div>

                            <div class="risk-question high-risk">
                                <div class="question-text">1.6) Does the child usually eat (> 3x/day) snacks that are sugar-containing?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="d-flex align-items-center gap-3">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="sugar_snacks_yes" name="sugar_snacks" value="yes">
                                        <label for="sugar_snacks_yes">Yes</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="sugar_snacks_no" name="sugar_snacks" value="no">
                                        <label for="sugar_snacks_no">No</label>
                                    </div>
                                </div>
                            </div>

                            <div class="risk-question high-risk">
                                <div class="question-text">1.7) Does the child usually drink (> 3x/day) beverages that are sugar-containing?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="d-flex align-items-center gap-3">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="sugar_beverages_yes" name="sugar_beverages" value="yes">
                                        <label for="sugar_beverages_yes">Yes</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="sugar_beverages_no" name="sugar_beverages" value="no">
                                        <label for="sugar_beverages_no">No</label>
                                    </div>
                                </div>
                            </div>

                            <button type="button" class="btn btn-primary next-section" data-next="#sectionTwo">Next</button>
                        </div>
                    </div>
                </div>

                <!-- Section 2: Clinical Risk Factors -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingTwo">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sectionTwo" aria-expanded="false" aria-controls="sectionTwo" disabled>
                            Section 2: Clinical Risk Factors
                        </button>
                    </h2>
                    <div id="sectionTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#questionnaireAccordion">
                        <div class="accordion-body">

                            <div class="risk-question moderate-risk">
                                <div class="question-text">2.1) Is the child wearing any intraoral appliance (e.g., braces, retainers)?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="d-flex align-items-center gap-3">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="appliance_yes" name="appliance" value="yes">
                                        <label for="appliance_yes">Yes</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="appliance_no" name="appliance" value="no">
                                        <label for="appliance_no">No</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="risk-question high-risk">
                                <div class="question-text">2.2) Is there visible dental plaque present on the child's teeth?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="d-flex align-items-center gap-3">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="plaque_yes" name="plaque" value="yes">
                                        <label for="plaque_yes">Yes</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="plaque_no" name="plaque" value="no">
                                        <label for="plaque_no">No</label>
                                    </div>
                                </div>
                            </div>

                            <div class="risk-question high-risk">
                                <div class="question-text">2.3) Does the child experience reduced salivary flow or show any symptoms of dry mouth?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="d-flex align-items-center gap-3">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="dry_mouth_yes" name="dry_mouth" value="yes">
                                        <label for="dry_mouth_yes">Yes</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="dry_mouth_no" name="dry_mouth" value="no">
                                        <label for="dry_mouth_no">No</label>
                                    </div>
                                </div>
                            </div>

                            <div class="risk-question high-risk">
                                <div class="question-text">2.4) Are there any developmental enamel defects such as opacity, translucency, or discolouration?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="d-flex align-items-center gap-3">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="enamel_defects_yes" name="enamel_defects" value="yes">
                                        <label for="enamel_defects_yes">Yes</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="enamel_defects_no" name="enamel_defects" value="no">
                                        <label for="enamel_defects_no">No</label>
                                    </div>
                                </div>
                            </div>

                            <button type="button" class="btn btn-primary next-section" data-next="#sectionThree">Next</button>
                        </div>
                    </div>
                </div>

                <!-- Section 3: Protective Factors -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingThree">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sectionThree" aria-expanded="false" aria-controls="sectionThree" disabled>
                            Section 3: Protective Factors
                        </button>
                    </h2>
                    <div id="sectionThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#questionnaireAccordion">
                        <div class="accordion-body">

                            <div class="risk-question low-risk">
                                <div class="question-text">3.1) Does the child drink optimally fluoridated water (e.g., municipal tap water in South Africa) or take fluoride supplements?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="d-flex align-items-center gap-3">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="fluoride_water_yes" name="fluoride_water" value="yes">
                                        <label for="fluoride_water_yes">Yes</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="fluoride_water_no" name="fluoride_water" value="no">
                                        <label for="fluoride_water_no">No</label>
                                    </div>
                                </div>
                            </div>

                            <div class="risk-question low-risk">
                                <div class="question-text">3.2) Are the child's teeth brushed daily with fluoride toothpaste (e.g., Colgate, Aquafresh, Sensodyne)?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="d-flex align-items-center gap-3">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="fluoride_toothpaste_yes" name="fluoride_toothpaste" value="yes">
                                        <label for="fluoride_toothpaste_yes">Yes</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="fluoride_toothpaste_no" name="fluoride_toothpaste" value="no">
                                        <label for="fluoride_toothpaste_no">No</label>
                                    </div>
                                </div>
                            </div>

                            <div class="risk-question low-risk">
                                <div class="question-text">3.3) Has the child received topical fluoride from a dental professional in the past year?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="d-flex align-items-center gap-3">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="topical_fluoride_yes" name="topical_fluoride" value="yes">
                                        <label for="topical_fluoride_yes">Yes</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="topical_fluoride_no" name="topical_fluoride" value="no">
                                        <label for="topical_fluoride_no">No</label>
                                    </div>
                                </div>
                            </div>

                            <div class="risk-question low-risk">
                                <div class="question-text">3.4) Does the child attend regular dental check-ups with a designated family dentist?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="d-flex align-items-center gap-3">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="regular_checkups_yes" name="regular_checkups" value="yes">
                                        <label for="regular_checkups_yes">Yes</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="regular_checkups_no" name="regular_checkups" value="no">
                                        <label for="regular_checkups_no">No</label>
                                    </div>
                                </div>
                            </div>

                            <button type="button" class="btn btn-primary next-section" data-next="#sectionFour">Next</button>
                        </div>
                    </div>
                </div>

                <!-- Section 4: Disease Indicators -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingFour">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sectionFour" aria-expanded="false" aria-controls="sectionFour" disabled>
                            Section 4: Disease Indicators (Current/History)
                        </button>
                    </h2>
                    <div id="sectionFour" class="accordion-collapse collapse" aria-labelledby="headingFour" data-bs-parent="#questionnaireAccordion">
                        <div class="accordion-body">

                            <div class="risk-question low-risk">
                                <div class="question-text">4.1) Are there any partially sealed pits and/or fissures present on any of the child's teeth?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="d-flex align-items-center gap-3">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="sealed_pits_yes" name="sealed_pits" value="yes">
                                        <label for="sealed_pits_yes">Yes</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="sealed_pits_no" name="sealed_pits" value="no">
                                        <label for="sealed_pits_no">No</label>
                                    </div>
                                </div>
                            </div>

                            <div class="risk-question low-risk">
                                <div class="question-text">4.2) Has the child received any restorative dental procedures within the past 3 years (e.g. fillings)?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="d-flex align-items-center gap-3">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="restorative_procedures_yes" name="restorative_procedures" value="yes">
                                        <label for="restorative_procedures_yes">Yes</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="restorative_procedures_no" name="restorative_procedures" value="no">
                                        <label for="restorative_procedures_no">No</label>
                                    </div>
                                </div>
                            </div>

                            <div class="risk-question moderate-risk">
                                <div class="question-text">4.3) Is there any clinically visible enamel change without structural breakdown (e.g., opacity, discoloration)?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="d-flex align-items-center gap-3">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="enamel_change_yes" name="enamel_change" value="yes">
                                        <label for="enamel_change_yes">Yes</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="enamel_change_no" name="enamel_change" value="no">
                                        <label for="enamel_change_no">No</label>
                                    </div>
                                </div>
                            </div>

                            <div class="risk-question high-risk">
                                <div class="question-text">4.4) Does the child have any observed internal dentin discoloration without breach of the enamel surface?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="d-flex align-items-center gap-3">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="dentin_discoloration_yes" name="dentin_discoloration" value="yes">
                                        <label for="dentin_discoloration_yes">Yes</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="dentin_discoloration_no" name="dentin_discoloration" value="no">
                                        <label for="dentin_discoloration_no">No</label>
                                    </div>
                                </div>
                            </div>

                            <div class="risk-question high-risk">
                                <div class="question-text">4.5) Are there non-cavitated (white-spot) lesions visible on smooth surfaces or along the gingival margin?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="d-flex align-items-center gap-3">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="white_spot_lesions_yes" name="white_spot_lesions" value="yes">
                                        <label for="white_spot_lesions_yes">Yes</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="white_spot_lesions_no" name="white_spot_lesions" value="no">
                                        <label for="white_spot_lesions_no">No</label>
                                    </div>
                                </div>
                            </div>

                            <div class="risk-question high-risk">
                                <div class="question-text">4.6) Are there any cavitated carious lesions clinically visible on examination?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="d-flex align-items-center gap-3">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="cavitated_lesions_yes" name="cavitated_lesions" value="yes">
                                        <label for="cavitated_lesions_yes">Yes</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="cavitated_lesions_no" name="cavitated_lesions" value="no">
                                        <label for="cavitated_lesions_no">No</label>
                                    </div>
                                </div>
                            </div>

                            <div class="risk-question high-risk">
                                <div class="question-text">4.7) Has the child received multiple recent dental restorations indicating active caries progression?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="d-flex align-items-center gap-3">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="multiple_restorations_yes" name="multiple_restorations" value="yes">
                                        <label for="multiple_restorations_yes">Yes</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="multiple_restorations_no" name="multiple_restorations" value="no">
                                        <label for="multiple_restorations_no">No</label>
                                    </div>
                                </div>
                            </div>

                            <div class="risk-question high-risk">
                                <div class="question-text">4.8) Are there any missing teeth attributed to caries or previous extraction due to decay?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="d-flex align-items-center gap-3">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="missing_teeth_yes" name="missing_teeth" value="yes">
                                        <label for="missing_teeth_yes">Yes</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="missing_teeth_no" name="missing_teeth" value="no">
                                        <label for="missing_teeth_no">No</label>
                                    </div>
                                </div>
                            </div>

                            <button type="button" class="btn btn-primary next-section" data-next="#sectionFive">Next</button>
                        </div>
                    </div>
                </div>

                <!-- Section 5: DMFT Assessment -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingFive">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sectionFive" aria-expanded="false" aria-controls="sectionFive" disabled>
                            Section 5: DMFT Assessment
                        </button>
                    </h2>
                    <div id="sectionFive" class="accordion-collapse collapse" aria-labelledby="headingFive" data-bs-parent="#questionnaireAccordion">
                        <div class="accordion-body">

                            <div class="text-center">
                                <h3 class="section-title">DMFT ASSESSMENT</h3>
                            </div>

                            <!-- Instructions -->
                            <p><strong>Instructions:</strong> Select the appropriate status for each tooth using the FDI numbering system.
                            <span class="required-asterisk">*</span></p>
                            
                            <table class="table table-bordered instructions-table">
                                <thead>
                                    <tr>
                                        <th>Permanent Tooth Code</th>
                                        <th>Description</th>
                                        <th>Primary Tooth Code</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td><strong>0</strong></td><td>Sound</td><td>A</td></tr>
                                    <tr><td><strong>1</strong></td><td>Decayed</td><td>B</td></tr>
                                    <tr><td><strong>2</strong></td><td>Filled</td><td>C</td></tr>
                                    <tr><td><strong>3</strong></td><td>Missing</td><td>D</td></tr>
                                    <tr><td><strong>4</strong></td><td>Missing due to caries</td><td>E</td></tr>
                                    <tr><td><strong>5</strong></td><td>Missing due to other</td><td>X</td></tr>
                                    <tr><td><strong>6</strong></td><td>Fissure sealant</td><td>F</td></tr>
                                    <tr><td><strong>7</strong></td><td>Bridge abutment</td><td></td></tr>
                                    <tr><td><strong>8</strong></td><td>Unerupted</td><td></td></tr>
                                    <tr><td><strong>9</strong></td><td>Excluded</td><td></td></tr>
                                </tbody>
                            </table>
                            <div class="mb-4">
                                <div class="alert alert-info"></div>
                                    <strong>How to read FDI Tooth Numbers:</strong>
                                    <ul class="mb-2">
                                        <li>
                                            <b>First digit</b>: Quadrant of the mouth<br>
                                            <span class="text-muted small">1 = Upper right, 2 = Upper left, 3 = Lower left, 4 = Lower right (for permanent teeth)<br>
                                            5 = Upper right, 6 = Upper left, 7 = Lower left, 8 = Lower right (for primary teeth)</span>
                                        </li>
                                        <li>
                                            <b>Second digit</b>: Tooth position from the midline (center), numbered 1 (central incisor) to 8 (third molar for permanent teeth) or 5 (second molar for primary teeth)
                                        </li>
                                    </ul>
                                    <div>
                                        <b>Permanent teeth:</b> Numbered <span class="badge bg-primary">11</span> to <span class="badge bg-primary">48</span><br>
                                        <b>Primary (baby) teeth:</b> Numbered <span class="badge bg-success">51</span> to <span class="badge bg-success">85</span>
                                    </div>
                                </div>
                            </div>

                            <div class="text-center my-3">
                                <a class="fdi-numbering-system" href="https://www.researchgate.net/publication/359614391_OdontoAI_A_human-in-the-loop_labeled_data_set_and_an_online_platform_to_boost_research_on_dental_panoramic_radiographs">
                                    <img src="{% static 'images/FDI_Numbering_System.png' %}" style="height:350px; width:auto; max-width:100%;" alt="fdi numbering system" loading="lazy" />
                                </a>
                            </div>
                            </a>


                            <!-- Permanent Teeth Upper -->
                            <h5>Permanent Teeth - Upper Jaw</h5>
                            <table class="dmft-table">
                                <tr>
                                    {% for tooth in permanent_upper %}
                                        {% if tooth != "," %}
                                        <td>
                                            <label for="tooth_{{ tooth }}">{{ tooth }}</label>
                                            <select name="tooth_{{ tooth }}" id="tooth_{{ tooth }}" class="tooth-select permanent-tooth">
                                                <option value="0">0</option>
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="9">9</option>
                                            </select>
                                        </td>
                                        {% endif %}
                                    {% endfor %}
                                </tr>
                            </table>

                            <!-- Permanent Teeth Lower -->
                            <h5>Permanent Teeth - Lower Jaw</h5>
                            <table class="dmft-table">
                                <tr>
                                    {% for tooth in permanent_lower %}
                                        {% if tooth != "," %}
                                        <td>
                                            <label for="tooth_{{ tooth }}">{{ tooth }}</label>
                                            <select name="tooth_{{ tooth }}" id="tooth_{{ tooth }}" class="tooth-select permanent-tooth">
                                                <option value="0">0</option>
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="9">9</option>
                                            </select>
                                        </td>
                                        {% endif %}
                                    {% endfor %}
                                </tr>
                            </table>

                            <!-- Primary Teeth Upper -->
                            <h5>Primary Teeth - Upper Jaw</h5>
                            <table class="dmft-table">
                                <tr>
                                    {% for tooth in primary_upper %}
                                        {% if tooth != "," %}
                                        <td>
                                            <label for="tooth_{{ tooth }}">{{ tooth }}</label>
                                            <select name="tooth_{{ tooth }}" id="tooth_{{ tooth }}" class="tooth-select primary-tooth">
                                                <option value="A">A</option>
                                                <option value="B">B</option>
                                                <option value="C">C</option>
                                                <option value="D">D</option>
                                                <option value="E">E</option>
                                                <option value="X">X</option>
                                                <option value="F">F</option>
                                            </select>
                                        </td>
                                        {% endif %}
                                    {% endfor %}
                                </tr>
                            </table>

                            <!-- Primary Teeth Lower -->
                            <h5>Primary Teeth - Lower Jaw</h5>
                            <table class="dmft-table">
                                <tr>
                                    {% for tooth in primary_lower %}
                                        {% if tooth != "," %}
                                        <td>
                                            <label for="tooth_{{ tooth }}">{{ tooth }}</label>
                                            <select name="tooth_{{ tooth }}" id="tooth_{{ tooth }}" class="tooth-select primary-tooth">
                                                <option value="A">A</option>
                                                <option value="B">B</option>
                                                <option value="C">C</option>
                                                <option value="D">D</option>
                                                <option value="E">E</option>
                                                <option value="X">X</option>
                                                <option value="F">F</option>
                                            </select>
                                        </td>
                                        {% endif %}
                                    {% endfor %}
                                </tr>
                            </table>

                            <div class="form-section text-center mt-4">
                                <button type="submit" class="btn btn-primary">Proceed</button>
                            </div>
                            
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    //automatically dismiss alerts
    setTimeout(function() {
        document.querySelectorAll('.auto-dismiss-alert').forEach(function(alert) {
            var bsAlert = bootstrap.Alert.getOrCreateInstance(alert);
            bsAlert.close();
        });
    }, 3000);

    //make checkboxes behave like radio buttons within each question group (only one can be chose at a time)
    document.querySelectorAll('.risk-question').forEach(function(question) {
        const checkboxes = question.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(function(checkbox) {
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    checkboxes.forEach(function(other) {
                        if (other !== checkbox) {
                            other.checked = false;
                        }
                    });
                }
            });
        });
    });

    //accordion section progression with validation (every question is required)
    document.querySelectorAll('.next-section').forEach(function(btn) {
        btn.addEventListener('click', function() {
            var currentSection = btn.closest('.accordion-collapse');
            var allQuestions = currentSection.querySelectorAll('.risk-question');
            var allAnswered = true;

            allQuestions.forEach(function(question) {
                //find all checkboxes in this question group
                var checkboxes = question.querySelectorAll('input[type="checkbox"]');
                //check if at least one is checked
                var answered = Array.from(checkboxes).some(cb => cb.checked);
                if (!answered) {
                    allAnswered = false;
                    //highlight the unanswered question
                    question.classList.add('border', 'border-danger');
                } else {
                    question.classList.remove('border', 'border-danger');
                }
            });

            if (!allAnswered) {
                alert("Please answer all required questions in this section before proceeding.");
                return;
            }

            //enable and open the next section
            var nextSection = document.querySelector(btn.getAttribute('data-next'));
            var nextHeaderBtn = nextSection.parentElement.querySelector('.accordion-button');
            nextHeaderBtn.removeAttribute('disabled');
            var bsCollapse = new bootstrap.Collapse(nextSection, {toggle: true});
            nextSection.scrollIntoView({behavior: "smooth"});
        });
    });
});
</script>

</body>
</html>