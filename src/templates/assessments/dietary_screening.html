{% load static %}

        {% if form.errors %}
        <div class="alert alert-danger">
            <ul>
            {% for field, errors in form.errors.items %}
                <li>{{ field }}: {{ errors|striptags }}</li>
            {% endfor %}
            </ul>
        </div>
        {% endif %}

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-warning alert-dismissible fade show auto-dismiss-alert" role="alert">
                <strong>{{ message }}</strong>
                <button type="button" class="btn btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
    {% endif %}
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(function() {
            document.querySelectorAll('.auto-dismiss-alert').forEach(function(alert) {
                var bsAlert = bootstrap.Alert.getOrCreateInstance(alert);
                bsAlert.close();
            });
        }, 5000); //3 seconds
    });
    </script>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dietary Assessment - Accordion Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .risk-question {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            /* transition: all 0.2s ease; */
        }
        .high-risk:hover {
            /* Changes when mouse hovers over */
            border-color: #dc3545; /* Border changes to blue */
            box-shadow: 0 4px 12px rgba(66, 133, 244, 0.15); /* Shadow becomes larger and blue-tinted */
            transform: translateY(-1px); /* Moves the card up by 1px creating "float" effect */
        }
        .high-risk {
            border-left: 4px solid #dc3545;
            background-color: #fdf2f2;
            /* transition: all 0.2s ease; */
        }
        .moderate-risk:hover {
            /* Changes when mouse hovers over */
            border-color: #ffc107; /* Border changes to blue */
            box-shadow: 0 4px 12px rgba(66, 133, 244, 0.15); /* Shadow becomes larger and blue-tinted */
            transform: translateY(-1px); /* Moves the card up by 1px creating "float" effect */
        }
        .moderate-risk {
            border-left: 4px solid #ffc107;
            background-color: #fffbf0;
            /* transition: all 0.2s ease; */
        }
        .low-risk:hover {
            /* Changes when mouse hovers over */
            border-color: #28a745; /* Border changes to blue */
            box-shadow: 0 4px 12px rgba(66, 133, 244, 0.15); /* Shadow becomes larger and blue-tinted */
            transform: translateY(-1px); /* Moves the card up by 1px creating "float" effect */
        }
        .low-risk {
            border-left: 4px solid #28a745;
            background-color: #f0f8f0;
            /* transition: all 0.2s ease; */
        }
        .no-risk:hover {
            /* Changes when mouse hovers over */
            border-color: #383838; /* Border changes to blue */
            box-shadow: 0 4px 12px rgba(66, 133, 244, 0.15); /* Shadow becomes larger and blue-tinted */
            transform: translateY(-1px); /* Moves the card up by 1px creating "float" effect */
        }
        .no-risk {
            border-left: 4px solid #383838;
            background-color: #f4f4f4;
            /* transition: all 0.2s ease; */
        }
        .question-text {
            font-weight: 500;
            margin-bottom: 10px;
        }
        .checkbox-item {
            margin-right: 15px;
        }
        .checkbox-item input {
            margin-right: 5px;
        }
        .income-grid .d-flex {
            margin-bottom: 8px;
        }
        .dmft-table {
            width: 100%;
            margin: 20px 0;
        }
        .dmft-table td {
            text-align: center;
            padding: 10px;
            border: 1px solid #ddd;
        }
        .dmft-table label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .tooth-select {
            width: 100%;
            padding: 5px;
        }
        .instructions-table th {
            background-color: #f8f9fa;
        }
        .section-title {
            color: #2c3e50;
            margin: 30px 0 20px 0;
        }
        .accordion-button:disabled {
            opacity: 0.6;
            pointer-events: none;
        }
        .required-asterisk {
            color: #dc3545;
            font-weight: bold;
            margin-left: 4px;
        }
        .view-examples {
            text-decoration: none;
            font-size: 0.875rem;
            cursor: pointer;
        }
        
        .view-examples:hover {
            text-decoration: underline;
        }

        /* Initially hide frequency questions with higher specificity */
        .risk-question .question-text:nth-child(n+3),
        .risk-question .d-flex.flex-wrap.gap-3.mt-2 {
            display: none !important;
        }

        /* Show frequency questions when they have the 'show-frequency' class */
        .risk-question.show-frequency .question-text:nth-child(n+3) {
            display: block !important;
        }
        
        .risk-question.show-frequency .d-flex.flex-wrap.gap-3.mt-2 {
            display: flex !important;
        }

    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">Dietary Assessment Form</h1>
        
        <form method="post" action="#" id="dietaryForm">
            
            {% csrf_token %}
            
            <!-- Hidden fields for workflow control -->
            {% if perform_both %}
                <input type="hidden" name="perform_both" value="true">
            {% endif %}

            <div class="accordion" id="questionnaireAccordion">

                <div class="text-center mb-4">
                    <h4>
                        Complete the Dietary Screening by Clicking on the Field that Applies to the Child
                    </h4>
                    <p class="text-muted">
                        <small>Note: If you select "No" for any food category, you can proceed without answering the frequency questions for that category.</small>
                    </p>
                </div>
                
                <!-- Section 1: Social / Behavioural / Medical Risk Factors -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingOne">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#sectionOne" aria-expanded="true" aria-controls="sectionOne">
                            Section 1: SWEET/SUGARY FOODS
                        </button>
                    </h2>
                    <div id="sectionOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#questionnaireAccordion">
                        <div class="accordion-body">

                            <div class="risk-question no-risk">
                                <div class="question-text">1. Does the child consume SWEET OR SUGARY FOODS, such as sweets, sugary gum, Chocolates, cakes, muffins, doughnuts, biscuits, sugary rusks, pudding, ice-cream, koeksisters, etc.?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="sugary-grid">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="sweet_sugary_foods_yes" name="sweet_sugary_foods" value="yes">
                                            <label for="sweet_sugary_foods_yes">Yes</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="sweet_sugary_foods_no" name="sweet_sugary_foods" value="no">
                                            <label for="sweet_sugary_foods_no">No</label>
                                        </div>
                                    </div>

                                    <div class="question-text"> How often do you usually consume these SWEET OR SUGARY FOODS?
                                        <span class="required-asterisk">*</span>
                                    </div>

                                    <div class="question-text"> DAILY?
                                        <span class="required-asterisk">*</span>
                                    </div>

                                    <div class="d-flex flex-wrap gap-3 mt-2">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="sweet_sugary_foods_1_3_day" name="sweet_sugary_foods_daily" value="1-3_day">
                                            <label for="sweet_sugary_foods_1_3_day">1-3 servings/day</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="sweet_sugary_foods_3_4_day" name="sweet_sugary_foods_daily" value="3-4_day">
                                            <label for="sweet_sugary_foods_3_4_day">3-4 servings/day</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="sweet_sugary_foods_4_6_day" name="sweet_sugary_foods_daily" value="4-6_day">
                                            <label for="sweet_sugary_foods_4_6_day">4-6 servings/day</label>
                                        </div>
                                    </div>

                                    <div class="question-text"> WEEKLY?
                                        <span class="required-asterisk">*</span>
                                    </div>

                                    <div class="d-flex flex-wrap gap-3 mt-2">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="sweet_sugary_foods_1_3_week" name="sweet_sugary_foods_weekly" value="1-3_week">
                                            <label for="sweet_sugary_foods_1_3_week">1-3 times/week</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="sweet_sugary_foods_3_4_week" name="sweet_sugary_foods_weekly" value="3-4_week">
                                            <label for="sweet_sugary_foods_3_4_week">3-4 times/week</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="sweet_sugary_foods_4_6_week" name="sweet_sugary_foods_weekly" value="4-6_week">
                                            <label for="sweet_sugary_foods_4_6_week">4-6 times/week</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="text-center mt-2">
                                    <small><a href="#" class="text-primary view-examples" data-example="sugarMeals">View Examples</a></small>
                                </div>

                            </div>

                            <button type="button" class="btn btn-primary next-section" data-next="#sectionTwo">Next</button>
                        </div>
                    </div>
                </div>

                <!-- Section 2: Clinical Risk Factors -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingTwo">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sectionTwo" aria-expanded="false" aria-controls="sectionTwo" disabled>
                            Section 2: COLD DRINKS AND JUICES
                        </button>
                    </h2>
                    <div id="sectionTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#questionnaireAccordion">
                        <div class="accordion-body">

                            <div class="risk-question no-risk">
                                <div class="question-text">Does the child consume COLD DRINKS AND JUICES, cooldrinks such as; Coca-Cola, Twizzer, Sprite, Kingsley, Grapetiser, Appletiser, juices such as; LiquiFruit, Cappy, Tropika, Krush, Sir Fruit, flavoured water such as Bonaqua, Aqualle, Thirsti, etc.?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="cold-drinks-grid">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="cold_drinks_juices_yes" name="cold_drinks_juices" value="yes">
                                            <label for="cold_drinks_juices_yes">Yes</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="cold_drinks_juices_no" name="cold_drinks_juices" value="no">
                                            <label for="cold_drinks_juices_no">No</label>
                                        </div>
                                    </div>

                                    <div class="question-text"> How often do you usually consume these COLD DRINKS AND JUICES?
                                        <span class="required-asterisk">*</span>
                                    </div>

                                    <div class="question-text"> DAILY?
                                        <span class="required-asterisk">*</span>
                                    </div>

                                    <div class="d-flex flex-wrap gap-3 mt-2">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="cold_drinks_juices_1_3_day" name="cold_drinks_juices_daily" value="1-3_day">
                                            <label for="cold_drinks_juices_1_3_day">1-3 servings/day</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="cold_drinks_juices_3_4_day" name="cold_drinks_juices_daily" value="3-4_day">
                                            <label for="cold_drinks_juices_3_4_day">3-4 servings/day</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="cold_drinks_juices_4_6_day" name="cold_drinks_juices_daily" value="4-6_day">
                                            <label for="cold_drinks_juices_4_6_day">4-6 servings/day</label>
                                        </div>
                                    </div>

                                    <div class="question-text"> WEEKLY?
                                        <span class="required-asterisk">*</span>
                                    </div>

                                    <div class="d-flex flex-wrap gap-3 mt-2">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="cold_drinks_juices_1_3_week" name="cold_drinks_juices_weekly" value="1-3_week">
                                            <label for="cold_drinks_juices_1_3_week">1-3 times/week</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="cold_drinks_juices_3_4_week" name="cold_drinks_juices_weekly" value="3-4_week">
                                            <label for="cold_drinks_juices_3_4_week">3-4 times/week</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="cold_drinks_juices_4_6_week" name="cold_drinks_juices_weekly" value="4-6_week">
                                            <label for="cold_drinks_juices_4_6_week">4-6 times/week</label>
                                        </div>
                                    </div>

                                </div>

                                <div class="text-center mt-2">
                                    <small><a href="#" class="text-primary view-examples" data-example="enamelDefects">View Examples</a></small>
                                </div>

                            </div>

                            <button type="button" class="btn btn-primary next-section" data-next="#sectionThree">Next</button>
                        </div>
                    </div>
                </div>

                <!-- Section 3: Protective Factors -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingThree">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sectionThree" aria-expanded="false" aria-controls="sectionThree" disabled>
                            Section 3: TAKE-AWAYS AND PROCESSED FOODS
                        </button>
                    </h2>
                    <div id="sectionThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#questionnaireAccordion">
                        <div class="accordion-body">

                            <div class="risk-question no-risk">
                                <div class="question-text">1. Does the child consume TAKE-AWAYS AND PROCESSED FOODS, takeaways such as; KFC. McDonalds, Romans Pizza, Debonairs, Wimpy, Hungry Lion, processed foods such as; potato chips, corn chips, hot chips, etc.?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="takeaways-grid">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="takeaways_processed_foods_yes" name="takeaways_processed_foods" value="yes">
                                            <label for="takeaways_processed_foods_yes">Yes</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="takeaways_processed_foods_no" name="takeaways_processed_foods" value="no">
                                            <label for="takeaways_processed_foods_no">No</label>
                                        </div>
                                    </div>

                                    <div class="question-text"> How often do you usually consume these TAKE-AWAYS AND PROCESSED FOODS?
                                        <span class="required-asterisk">*</span>
                                    </div>

                                    <div class="question-text"> DAILY?
                                        <span class="required-asterisk">*</span>
                                    </div>

                                    <div class="d-flex flex-wrap gap-3 mt-2">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="takeaways_processed_foods_1_3_day" name="takeaways_processed_foods_daily" value="1-3_day">
                                            <label for="takeaways_processed_foods_1_3_day">1-3 servings/day</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="takeaways_processed_foods_3_4_day" name="takeaways_processed_foods_daily" value="3-4_day">
                                            <label for="takeaways_processed_foods_3_4_day">3-4 servings/day</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="takeaways_processed_foods_4_6_day" name="takeaways_processed_foods_daily" value="4-6_day">
                                            <label for="takeaways_processed_foods_4_6_day">4-6 servings/day</label>
                                        </div>
                                    </div>

                                    <div class="question-text"> WEEKLY?
                                        <span class="required-asterisk">*</span>
                                    </div>

                                    <div class="d-flex flex-wrap gap-3 mt-2">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="takeaways_processed_foods_1_3_week" name="takeaways_processed_foods_weekly" value="1-3_week">
                                            <label for="takeaways_processed_foods_1_3_week">1-3 times/week</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="takeaways_processed_foods_3_4_week" name="takeaways_processed_foods_weekly" value="3-4_week">
                                            <label for="takeaways_processed_foods_3_4_week">3-4 times/week</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="takeaways_processed_foods_4_6_week" name="takeaways_processed_foods_weekly" value="4-6_week">
                                            <label for="takeaways_processed_foods_4_6_week">4-6 times/week</label>
                                        </div>
                                    </div>

                                </div>

                                <button type="button" class="btn btn-primary next-section" data-next="#sectionFour">Next</button>
                        </div>
                    </div>
                </div>

                <!-- Section 4: Disease Indicators -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingFour">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sectionFour" aria-expanded="false" aria-controls="sectionFour" disabled>
                            Section 4: SALTY SNACKS
                        </button>
                    </h2>
                    <div id="sectionFour" class="accordion-collapse collapse" aria-labelledby="headingFour" data-bs-parent="#questionnaireAccordion">
                        <div class="accordion-body">

                            <div class="risk-question no-risk">
                                <div class="question-text">Does the child consume SALTY SNACKS, snacks such as; salted peanuts, pretzels, crackers, chips, niknaks, etc.?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="salty-snacks-grid">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="salty_snacks_yes" name="salty_snacks" value="yes">
                                            <label for="salty_snacks_yes">Yes</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="salty_snacks_no" name="salty_snacks" value="no">
                                            <label for="salty_snacks_no">No</label>
                                        </div>
                                    </div>

                                    <div class="question-text"> How often do you usually consume these SALTY SNACKS?
                                        <span class="required-asterisk">*</span>
                                    </div>

                                    <div class="question-text"> DAILY?
                                        <span class="required-asterisk">*</span>
                                    </div>

                                    <div class="d-flex flex-wrap gap-3 mt-2">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="salty_snacks_1_3_day" name="salty_snacks_daily" value="1-3_day">
                                            <label for="salty_snacks_1_3_day">1-3 servings/day</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="salty_snacks_3_4_day" name="salty_snacks_daily" value="3-4_day">
                                            <label for="salty_snacks_3_4_day">3-4 servings/day</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="salty_snacks_4_6_day" name="salty_snacks_daily" value="4-6_day">
                                            <label for="salty_snacks_4_6_day">4-6 servings/day</label>
                                        </div>
                                    </div>

                                    <div class="question-text"> WEEKLY?
                                        <span class="required-asterisk">*</span>
                                    </div>

                                    <div class="d-flex flex-wrap gap-3 mt-2">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="salty_snacks_1_3_week" name="salty_snacks_weekly" value="1-3_week">
                                            <label for="salty_snacks_1_3_week">1-3 times/week</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="salty_snacks_3_4_week" name="salty_snacks_weekly" value="3-4_week">
                                            <label for="salty_snacks_3_4_week">3-4 times/week</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="salty_snacks_4_6_week" name="salty_snacks_weekly" value="4-6_week">
                                            <label for="salty_snacks_4_6_week">4-6 times/week</label>
                                        </div>
                                    </div>

                                </div>

                                <button type="button" class="btn btn-primary next-section" data-next="#sectionFive">Next</button>

                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section 5: DMFT Assessment -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingFive">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sectionFive" aria-expanded="false" aria-controls="sectionFive" disabled>
                            Section 5: SPREADS
                        </button>
                    </h2>
                    <div id="sectionFive" class="accordion-collapse collapse" aria-labelledby="headingFive" data-bs-parent="#questionnaireAccordion">
                        <div class="accordion-body">

                            <div class="risk-question no-risk">
                                <div class="question-text">Does the child consume SPREADS, spreads such as; jam, syrup, honey, choclate spreads such as nutella, etc.?
                                    <span class="required-asterisk">*</span>
                                </div>
                                <div class="income-grid">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="spreads_yes" name="spreads" value="yes">
                                            <label for="spreads_yes">Yes</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="spreads_no" name="spreads" value="no">
                                            <label for="spreads_no">No</label>
                                        </div>
                                    </div>

                                    <div class="question-text"> How often do you usually consume these SPREADS?
                                        <span class="required-asterisk">*</span>
                                    </div>

                                    <div class="question-text"> DAILY?
                                        <span class="required-asterisk">*</span>
                                    </div>

                                    <div class="d-flex flex-wrap gap-3 mt-2">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="spreads_1_3_day" name="spreads_daily" value="1-3_day">
                                            <label for="spreads_1_3_day">1-3 servings/day</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="spreads_3_4_day" name="spreads_daily" value="3-4_day">
                                            <label for="spreads_3_4_day">3-4 servings/day</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="spreads_4_6_day" name="spreads_daily" value="4-6_day">
                                            <label for="spreads_4_6_day">4-6 servings/day</label>
                                        </div>
                                    </div>

                                    <div class="question-text"> WEEKLY?
                                        <span class="required-asterisk">*</span>
                                    </div>

                                    <div class="d-flex flex-wrap gap-3 mt-2">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="spreads_1_3_week" name="spreads_weekly" value="1-3_week">
                                            <label for="spreads_1_3_week">1-3 times/week</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="spreads_3_4_week" name="spreads_weekly" value="3-4_week">
                                            <label for="spreads_3_4_week">3-4 times/week</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="spreads_4_6_week" name="spreads_weekly" value="4-6_week">
                                            <label for="spreads_4_6_week">4-6 times/week</label>
                                        </div>
                                    </div>

                                </div>


                            <div class="form-section text-center mt-4">
                                {% if perform_both %}
                                    <button type="submit" class="btn btn-primary">Complete Dietary & Proceed to Dental</button>
                                {% else %}
                                    <button type="submit" class="btn btn-primary">Complete Dietary Screening</button>
                                {% endif %}
                            </div>
                            
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Examples</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <img id="exampleImage" src="" alt="Example" class="img-fluid" style="max-height: 400px;">
                    <p id="exampleDescription" class="mt-3"></p>
                </div>
            </div>
        </div>
    </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Automatically dismiss alerts
    setTimeout(function() {
        document.querySelectorAll('.auto-dismiss-alert').forEach(function(alert) {
            var bsAlert = bootstrap.Alert.getOrCreateInstance(alert);
            bsAlert.close();
        });
    }, 3000);

    // Make checkboxes behave like radio buttons within each logical group (by name) inside each question
    document.querySelectorAll('.risk-question').forEach(function(question) {
        // Find all unique checkbox name attributes within this question
        const names = Array.from(new Set(Array.from(question.querySelectorAll('input[type="checkbox"]')).map(cb => cb.name)));
        names.forEach(function(name) {
            const group = question.querySelectorAll('input[type="checkbox"][name="' + name + '"]');
            group.forEach(function(checkbox) {
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        group.forEach(function(other) {
                            if (other !== checkbox) {
                                other.checked = false;
                            }
                        });
                        
                        // If this is a main yes/no question and "No" is selected, hide frequency questions
                        if (this.value === 'no' && names[0] === name) {
                            // Hide frequency questions by removing the show-frequency class
                            question.classList.remove('show-frequency');
                            
                            // Clear any selected frequency options
                            names.slice(1).forEach(function(freqName) {
                                const freqGroup = question.querySelectorAll('input[type="checkbox"][name="' + freqName + '"]');
                                freqGroup.forEach(function(cb) {
                                    cb.checked = false;
                                });
                            });
                        } else if (this.value === 'yes' && names[0] === name) {
                            // Show frequency questions by adding the show-frequency class
                            question.classList.add('show-frequency');
                        }
                    }
                });
            });
        });
    });

    // Accordion section progression with validation (conditional based on "No" answers)
    document.querySelectorAll('.next-section').forEach(function(btn) {
        btn.addEventListener('click', function() {
            console.log('Next button clicked'); // Debug log
            
            var currentSection = btn.closest('.accordion-collapse');
            var allQuestions = currentSection.querySelectorAll('.risk-question');
            var allAnswered = true;

            allQuestions.forEach(function(question) {
                // Get all checkbox groups by name within this question
                const names = Array.from(new Set(Array.from(question.querySelectorAll('input[type="checkbox"]')).map(cb => cb.name)));
                let questionAnswered = true;
                
                // Check if the main question (first group) has been answered
                const mainGroup = names[0]; // First group is typically the yes/no question
                const mainCheckboxes = question.querySelectorAll('input[type="checkbox"][name="' + mainGroup + '"]');
                const mainAnswered = Array.from(mainCheckboxes).some(cb => cb.checked);
                
                if (!mainAnswered) {
                    // Main question not answered - this is required
                    questionAnswered = false;
                    console.log('Main question not answered for:', mainGroup); // Debug log
                } else {
                    // Check if user answered "No" to main question
                    const noSelected = Array.from(mainCheckboxes).some(cb => cb.checked && cb.value === 'no');
                    
                    if (noSelected) {
                        // If "No" is selected, we don't need to validate frequency questions
                        // Set default values for frequency questions
                        names.slice(1).forEach(function(name) {
                            const group = question.querySelectorAll('input[type="checkbox"][name="' + name + '"]');
                            // Uncheck all frequency options when "No" is selected
                            group.forEach(function(cb) {
                                cb.checked = false;
                            });
                        });
                    } else {
                        // If "Yes" is selected, don't require frequency questions for now (simplified validation)
                        // TODO: Re-enable frequency validation later if needed
                        /*
                        names.slice(1).forEach(function(name) {
                            const group = question.querySelectorAll('input[type="checkbox"][name="' + name + '"]');
                            if (group.length > 0 && !Array.from(group).some(cb => cb.checked)) {
                                questionAnswered = false;
                            }
                        });
                        */
                    }
                }
                
                if (!questionAnswered) {
                    allAnswered = false;
                    question.classList.add('border', 'border-danger');
                } else {
                    question.classList.remove('border', 'border-danger');
                }
            });

            if (!allAnswered) {
                alert("Please answer all required questions in this section before proceeding.");
                return;
            }

            console.log('All questions answered, proceeding to next section'); // Debug log
            
            // Enable and open the next section
            var nextSectionId = btn.getAttribute('data-next');
            var nextSection = document.querySelector(nextSectionId);
            
            if (!nextSection) {
                console.error('Next section not found:', nextSectionId);
                return;
            }
            
            var nextAccordionItem = nextSection.closest('.accordion-item');
            var nextHeaderBtn = nextAccordionItem.querySelector('.accordion-button');
            
            if (nextHeaderBtn) {
                nextHeaderBtn.removeAttribute('disabled');
                console.log('Enabled next section button');
            }
            
            try {
                var bsCollapse = new bootstrap.Collapse(nextSection, {toggle: true});
                nextSection.scrollIntoView({behavior: "smooth"});
                console.log('Opened next section:', nextSectionId);
            } catch (error) {
                console.error('Error opening next section:', error);
                // Fallback: manually show the section
                nextSection.classList.add('show');
                nextSection.scrollIntoView({behavior: "smooth"});
            }
        });
    });

    // Example modal functionality
    const exampleModal = new bootstrap.Modal(document.getElementById('exampleModal'));
    const exampleImage = document.getElementById('exampleImage');
    const exampleDescription = document.getElementById('exampleDescription');
    const exampleModalLabel = document.getElementById('exampleModalLabel');

    const examples = {
        'sugarMeals': {
            title: 'Sugary Meal Examples',
            image: "{% static 'images/examples/sugary_meal_example.jpg' %}",
            description: 'Examples of meals containing sugar that are consumed more than 3 times per day'
        },
        'sugarSnacks': {
            title: 'Sugary Snack Examples',
            image: "{% static 'images/examples/sugary_snack_example.jpg' %}",
            description: 'Examples of sugary snacks consumed more than 3 times per day'
        },
        'sugarDrinks': {
            title: 'Sugary Drink Examples',
            image: "{% static 'images/examples/sugary_drink_example.jpg' %}",
            description: 'Examples of sugar-containing beverages consumed more than 3 times per day'
        },
        'appliance': {
            title: 'Intraoral Appliances Examples',
            image: "{% static 'images/examples/appliance_example.jpg' %}",
            description: 'Examples of braces, retainers, and other intraoral appliances'
        },
        'plaque': {
            title: 'Dental Plaque Examples',
            image: "{% static 'images/examples/plaque_example.jpg' %}",
            description: 'Visible dental plaque on teeth surfaces'
        },
        'enamelDefects': {
            title: 'Enamel Defects Examples',
            image: "{% static 'images/examples/enamel_defects_example.jpg' %}",
            description: 'Examples of opacity, translucency, and discoloration'
        },
        'fluoride': {
            title: 'Fluoride Water Examples',
            image: "{% static 'images/examples/fluoride_example.jpg' %}",
            description: 'Examples of fluoridated water sources and fluoride supplements'
        },
        'toothpaste': {
            title: 'Fluoride Toothpaste Examples',
            image: "{% static 'images/examples/toothpaste_example.jpg' %}",
            description: 'Examples of fluoride-containing toothpaste brands'
        },
        'fissures': {
            title: 'Pit and Fissure Sealants',
            image: "{% static 'images/examples/fissures_example.jpg' %}",
            description: 'Examples of sealed pits and fissures on teeth'
        },
        'restorative3': {
            title: 'Dental Restorations Examples',
            image: "{% static 'images/examples/restorative_example.jpg' %}",
            description: 'Examples of fillings and other restorative procedures'
        },
        'enamelNoBreakdown': {
            title: 'Enamel Changes Without Breakdown',
            image: "{% static 'images/examples/no_enamel_breakdown_example.jpg' %}",
            description: 'Examples of enamel opacity and discoloration without structural breakdown'
        },
        'internalDiscolouration': {
            title: 'Internal Dentin Discoloration',
            image: "{% static 'images/examples/internal_discoloration_example.jpg' %}",
            description: 'Examples of internal dentin discoloration without enamel breach'
        },
        'whiteSpot': {
            title: 'White Spot Lesions',
            image: "{% static 'images/examples/white_spot_example.jpg' %}",
            description: 'Examples of non-cavitated white-spot lesions on smooth surfaces'
        },
        'visibleLesions': {
            title: 'Cavitated Lesions',
            image: "{% static 'images/examples/visible_lesions_example.jpg' %}",
            description: 'Examples of cavitated carious lesions visible on examination'
        }
    };

    // Handle view examples clicks
    document.querySelectorAll('.view-examples').forEach(function(link) {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const exampleType = this.getAttribute('data-example');
            const example = examples[exampleType];

            if (example) {
                exampleModalLabel.textContent = example.title;
                exampleImage.src = example.image;
                exampleDescription.textContent = example.description;
                exampleModal.show();
            }
        });
    });

    // Form submission validation
    document.getElementById('dietaryForm').addEventListener('submit', function(e) {
        var allSections = document.querySelectorAll('.risk-question');
        var allValid = true;
        var errorMessages = [];

        allSections.forEach(function(question) {
            const names = Array.from(new Set(Array.from(question.querySelectorAll('input[type="checkbox"]')).map(cb => cb.name)));
            
            if (names.length > 0) {
                const mainGroup = names[0];
                const mainCheckboxes = question.querySelectorAll('input[type="checkbox"][name="' + mainGroup + '"]');
                const mainAnswered = Array.from(mainCheckboxes).some(cb => cb.checked);
                
                if (!mainAnswered) {
                    allValid = false;
                    errorMessages.push(`Please answer the main question for ${mainGroup.replace(/_/g, ' ')}`);
                    question.classList.add('border', 'border-danger');
                } else {
                    const noSelected = Array.from(mainCheckboxes).some(cb => cb.checked && cb.value === 'no');
                    
                    if (!noSelected) {
                        // If "Yes" is selected, validate frequency questions
                        names.slice(1).forEach(function(name) {
                            const group = question.querySelectorAll('input[type="checkbox"][name="' + name + '"]');
                            if (group.length > 0 && !Array.from(group).some(cb => cb.checked)) {
                                allValid = false;
                                errorMessages.push(`Please answer the frequency question for ${name.replace(/_/g, ' ')}`);
                                question.classList.add('border', 'border-danger');
                            }
                        });
                    }
                    
                    if (allValid) {
                        question.classList.remove('border', 'border-danger');
                    }
                }
            }
        });

        if (!allValid) {
            e.preventDefault();
            alert("Please complete all required questions:\n" + errorMessages.join('\n'));
            return false;
        }
    });

});
</script>

</body>
</html>